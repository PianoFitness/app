# Lefthook configuration for Piano Fitness
# Git hooks for code quality and consistency

pre-commit:
  commands:
    # Step 1: Apply automatic fixes and format (only for Dart files)
    dart-fixes:
      glob: "*.dart"
      run: |
        echo "ğŸ”§ Applying automatic Dart fixes..."
        dart fix --apply
        echo "ğŸ¨ Formatting Dart code..."
        dart format {staged_files}
        echo "ğŸ“‹ Re-staging fixed files..."
        git add {staged_files}
      stage_fixed: true

    # Step 2: Fix and lint markdown files
    markdown-lint:
      glob: "*.md"
      run: |
        echo "ğŸ“ Fixing and linting markdown files..."
        markdownlint --fix {staged_files}
        echo "ğŸ“‹ Re-staging fixed markdown files..."
        git add {staged_files}
      stage_fixed: true

    # Step 3: Run analysis after fixes (only for Dart files)
    dart-analyze:
      glob: "*.dart"
      run: |
        echo "ğŸ” Analyzing Dart code..."
        flutter analyze --no-fatal-infos
      fail_text: |
        âŒ Flutter analyze found issues that cannot be auto-fixed.
        Please review and fix the remaining warnings/errors before committing.
        Run 'flutter analyze' to see details.

pre-push:
  commands:
    # Run full test suite before pushing
    test:
      run: flutter test
      fail_text: "Tests failed. Please fix them before pushing."

commit-msg:
  commands:
    # Ensure commit messages follow conventional commits format
    conventional:
      run: dart scripts/validate_commit_msg.dart {1}
